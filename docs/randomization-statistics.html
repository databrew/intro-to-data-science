<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Module 51 Randomization statistics | DataBOOM: the canon for data science</title>
  <meta name="description" content="Data science is just data and science. But it’s better with pizza." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Module 51 Randomization statistics | DataBOOM: the canon for data science" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Data science is just data and science. But it’s better with pizza." />
  <meta name="github-repo" content="databrew/intro-to-data-science" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Module 51 Randomization statistics | DataBOOM: the canon for data science" />
  
  <meta name="twitter:description" content="Data science is just data and science. But it’s better with pizza." />
  

<meta name="author" content="Databrew" />


<meta name="date" content="2021-05-13" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon" />
<link rel="prev" href="apply-family.html"/>
<link rel="next" href="iterative-simulations.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">DataBOOM: the canon for data science </a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Welcome!</a></li>
<li class="part"><span><b>I Core theory</b></span></li>
<li class="chapter" data-level="2" data-path="principles-of-data-science.html"><a href="principles-of-data-science.html"><i class="fa fa-check"></i><b>2</b> Principles of data science</a></li>
<li class="chapter" data-level="3" data-path="visualizing-data.html"><a href="visualizing-data.html"><i class="fa fa-check"></i><b>3</b> Visualizing data</a></li>
<li class="chapter" data-level="4" data-path="writing-about-data.html"><a href="writing-about-data.html"><i class="fa fa-check"></i><b>4</b> Writing about data</a></li>
<li class="chapter" data-level="5" data-path="data-ethics.html"><a href="data-ethics.html"><i class="fa fa-check"></i><b>5</b> Data ethics</a></li>
<li class="part"><span><b>II Getting started</b></span></li>
<li class="chapter" data-level="6" data-path="setting-up-rstudio.html"><a href="setting-up-rstudio.html"><i class="fa fa-check"></i><b>6</b> Setting up <code>RStudio</code></a></li>
<li class="chapter" data-level="7" data-path="running-r-code.html"><a href="running-r-code.html"><i class="fa fa-check"></i><b>7</b> Running R code</a></li>
<li class="chapter" data-level="8" data-path="using-rstudio-and-r-scripts.html"><a href="using-rstudio-and-r-scripts.html"><i class="fa fa-check"></i><b>8</b> Using <code>RStudio</code> and <code>R</code> scripts</a></li>
<li class="chapter" data-level="9" data-path="variables-in-r.html"><a href="variables-in-r.html"><i class="fa fa-check"></i><b>9</b> Variables in <code>R</code></a></li>
<li class="chapter" data-level="10" data-path="structures-for-data-in-r.html"><a href="structures-for-data-in-r.html"><i class="fa fa-check"></i><b>10</b> Structures for data in <code>R</code></a></li>
<li class="chapter" data-level="11" data-path="calling-functions.html"><a href="calling-functions.html"><i class="fa fa-check"></i><b>11</b> Calling functions</a></li>
<li class="chapter" data-level="12" data-path="base-plots.html"><a href="base-plots.html"><i class="fa fa-check"></i><b>12</b> Base plots</a></li>
<li class="chapter" data-level="13" data-path="packages.html"><a href="packages.html"><i class="fa fa-check"></i><b>13</b> Packages</a></li>
<li class="chapter" data-level="14" data-path="basics-of-ggplot.html"><a href="basics-of-ggplot.html"><i class="fa fa-check"></i><b>14</b> Basics of ggplot</a></li>
<li class="part"><span><b>III Working with data in R</b></span></li>
<li class="chapter" data-level="15" data-path="importing-data.html"><a href="importing-data.html"><i class="fa fa-check"></i><b>15</b> Importing data</a></li>
<li class="chapter" data-level="16" data-path="dataframes.html"><a href="dataframes.html"><i class="fa fa-check"></i><b>16</b> Dataframes</a></li>
<li class="chapter" data-level="17" data-path="data-wrangling.html"><a href="data-wrangling.html"><i class="fa fa-check"></i><b>17</b> Data wrangling</a></li>
<li class="chapter" data-level="18" data-path="exporting-data-plots.html"><a href="exporting-data-plots.html"><i class="fa fa-check"></i><b>18</b> Exporting data &amp; plots</a></li>
<li class="part"><span><b>IV Exploring &amp; analyzing data</b></span></li>
<li class="chapter" data-level="19" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html"><i class="fa fa-check"></i><b>19</b> Exploratory Data Analysis</a></li>
<li class="chapter" data-level="20" data-path="significance-statistics.html"><a href="significance-statistics.html"><i class="fa fa-check"></i><b>20</b> Significance statistics</a></li>
<li class="chapter" data-level="21" data-path="summarizing-datasets.html"><a href="summarizing-datasets.html"><i class="fa fa-check"></i><b>21</b> Summarizing datasets</a></li>
<li class="part"><span><b>V Your R tool bag</b></span></li>
<li class="chapter" data-level="22" data-path="joining-datasets.html"><a href="joining-datasets.html"><i class="fa fa-check"></i><b>22</b> Joining datasets</a></li>
<li class="chapter" data-level="23" data-path="writing-functions.html"><a href="writing-functions.html"><i class="fa fa-check"></i><b>23</b> Writing functions</a></li>
<li class="chapter" data-level="24" data-path="for-loops.html"><a href="for-loops.html"><i class="fa fa-check"></i><b>24</b> <code>for</code> loops</a></li>
<li class="chapter" data-level="25" data-path="conditional-statements.html"><a href="conditional-statements.html"><i class="fa fa-check"></i><b>25</b> Conditional statements</a></li>
<li class="chapter" data-level="26" data-path="working-with-text.html"><a href="working-with-text.html"><i class="fa fa-check"></i><b>26</b> Working with text</a></li>
<li class="chapter" data-level="27" data-path="working-with-dates-times.html"><a href="working-with-dates-times.html"><i class="fa fa-check"></i><b>27</b> Working with dates &amp; times</a></li>
<li class="chapter" data-level="28" data-path="working-with-factors.html"><a href="working-with-factors.html"><i class="fa fa-check"></i><b>28</b> Working with factors</a></li>
<li class="chapter" data-level="29" data-path="cleaning-messy-data.html"><a href="cleaning-messy-data.html"><i class="fa fa-check"></i><b>29</b> Cleaning messy data</a></li>
<li class="chapter" data-level="30" data-path="matrices-lists.html"><a href="matrices-lists.html"><i class="fa fa-check"></i><b>30</b> Matrices &amp; lists</a></li>
<li class="chapter" data-level="31" data-path="pipes.html"><a href="pipes.html"><i class="fa fa-check"></i><b>31</b> Pipes</a></li>
<li class="chapter" data-level="32" data-path="excel-files-googlesheets.html"><a href="excel-files-googlesheets.html"><i class="fa fa-check"></i><b>32</b> Excel files &amp; GoogleSheets</a></li>
<li class="part"><span><b>VI Interactive dashboards</b></span></li>
<li class="chapter" data-level="33" data-path="intro-to-shiny-apps.html"><a href="intro-to-shiny-apps.html"><i class="fa fa-check"></i><b>33</b> Intro to Shiny apps</a></li>
<li class="chapter" data-level="34" data-path="shiny-dashboards.html"><a href="shiny-dashboards.html"><i class="fa fa-check"></i><b>34</b> Shiny dashboards</a></li>
<li class="chapter" data-level="35" data-path="data-entry-apps.html"><a href="data-entry-apps.html"><i class="fa fa-check"></i><b>35</b> Data entry apps</a></li>
<li class="part"><span><b>VII Databases</b></span></li>
<li class="chapter" data-level="36" data-path="introduction-1.html"><a href="introduction-1.html"><i class="fa fa-check"></i><b>36</b> Introduction</a></li>
<li class="chapter" data-level="37" data-path="platforms.html"><a href="platforms.html"><i class="fa fa-check"></i><b>37</b> Platforms</a></li>
<li class="chapter" data-level="38" data-path="alternatives.html"><a href="alternatives.html"><i class="fa fa-check"></i><b>38</b> Alternatives</a></li>
<li class="chapter" data-level="39" data-path="practices.html"><a href="practices.html"><i class="fa fa-check"></i><b>39</b> Practices</a></li>
<li class="part"><span><b>VIII Documenting your work</b></span></li>
<li class="chapter" data-level="40" data-path="r-markdown.html"><a href="r-markdown.html"><i class="fa fa-check"></i><b>40</b> R Markdown</a></li>
<li class="chapter" data-level="41" data-path="reproducible-research.html"><a href="reproducible-research.html"><i class="fa fa-check"></i><b>41</b> Reproducible research</a></li>
<li class="chapter" data-level="42" data-path="automated-reporting.html"><a href="automated-reporting.html"><i class="fa fa-check"></i><b>42</b> Automated reporting</a></li>
<li class="chapter" data-level="43" data-path="formatting-standards.html"><a href="formatting-standards.html"><i class="fa fa-check"></i><b>43</b> Formatting standards</a></li>
<li class="chapter" data-level="44" data-path="git.html"><a href="git.html"><i class="fa fa-check"></i><b>44</b> Git</a></li>
<li class="part"><span><b>IX Version control and teamwork</b></span></li>
<li class="chapter" data-level="" data-path="how-most-people-do-version-control.html"><a href="how-most-people-do-version-control.html"><i class="fa fa-check"></i>How most people do version control</a></li>
<li class="chapter" data-level="" data-path="there-is-a-better-way.html"><a href="there-is-a-better-way.html"><i class="fa fa-check"></i>There is a better way</a></li>
<li class="part"><span><b>X Writing about data</b></span></li>
<li class="chapter" data-level="" data-path="types-of-writing.html"><a href="types-of-writing.html"><i class="fa fa-check"></i>Types of writing</a></li>
<li class="chapter" data-level="45" data-path="sections-of-a-report.html"><a href="sections-of-a-report.html"><i class="fa fa-check"></i><b>45</b> Sections of a report</a></li>
<li class="chapter" data-level="46" data-path="elements-of-structure-style.html"><a href="elements-of-structure-style.html"><i class="fa fa-check"></i><b>46</b> Elements of structure &amp; style</a></li>
<li class="part"><span><b>XI Creating websites</b></span></li>
<li class="part"><span><b>XII Advanced skills</b></span></li>
<li class="chapter" data-level="47" data-path="mapping.html"><a href="mapping.html"><i class="fa fa-check"></i><b>47</b> Mapping</a></li>
<li class="chapter" data-level="48" data-path="geographic-computing-gis.html"><a href="geographic-computing-gis.html"><i class="fa fa-check"></i><b>48</b> Geographic computing &amp; GIS</a></li>
<li class="chapter" data-level="49" data-path="statistical-modeling.html"><a href="statistical-modeling.html"><i class="fa fa-check"></i><b>49</b> Statistical modeling</a></li>
<li class="chapter" data-level="50" data-path="apply-family.html"><a href="apply-family.html"><i class="fa fa-check"></i><b>50</b> Apply family</a></li>
<li class="chapter" data-level="51" data-path="randomization-statistics.html"><a href="randomization-statistics.html"><i class="fa fa-check"></i><b>51</b> Randomization statistics</a></li>
<li class="chapter" data-level="52" data-path="iterative-simulations.html"><a href="iterative-simulations.html"><i class="fa fa-check"></i><b>52</b> Iterative simulations</a></li>
<li class="chapter" data-level="53" data-path="image-analysis.html"><a href="image-analysis.html"><i class="fa fa-check"></i><b>53</b> Image analysis</a></li>
<li class="chapter" data-level="54" data-path="machine-learning.html"><a href="machine-learning.html"><i class="fa fa-check"></i><b>54</b> Machine learning</a></li>
<li class="chapter" data-level="55" data-path="template.html"><a href="template.html"><i class="fa fa-check"></i><b>55</b> Template</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/databrew/intro-to-data-science" target="blank">Databrew LLC</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"><code>DataBOOM</code>: the canon for data science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="randomization-statistics" class="section level1">
<h1><span class="header-section-number">Module 51</span> Randomization statistics</h1>
<div id="learning-goals-17" class="section level2 unnumbered">
<h2>Learning goals</h2>
<ul>
<li>Understand what randomization analyses are, and why they are awesome.</li>
<li>Use randomization to determine if an outcome is significantly unexpected.</li>
<li>Use randomization to compare two distributions.</li>
<li>Use randomization to ask whether two variables are correlated</li>
<li>Use randomization to determine the chances that a correlation is declining or increasing.</li>
</ul>
</div>
<div id="basic-idea" class="section level2 unnumbered">
<h2>Basic idea</h2>
<p>Classic significance statistics (i.e., p-values) are based on the frequentist framework in which you <em>estimate</em> the probability of an <em>observed</em> outcome to what would be <em>expected</em> if a null hypothesis were true. In a t-test, for example, you are asking, “What are the chances of observing what I have if these two sample sets were not meaningfully different?”</p>
<p>The key word in that first sentence is <em>estimate</em>. When frequentist theory was originally developed, statisticians did not have computers capable of generating vast amounts of random numbers. So they had to <em>estimate</em> p-values by developing strict rules and expectations about the way data are distributed. These rules had the result of (1) placing a lot of constraints on the way statistsics could be done, (2) forcing the development of increasingly specific tests for each strange sampling scenario, (3) confusing students trying to learn statistics, and (4) requiring the use of simplistic conventions, such as the 0.05 significance threshold, in order to make statistical results somewhat intelligible.</p>
<p>But in the age of <code>R</code>, null distributions no longer need to be theoretical, nor do p-values need to be hypothetical. We can actually <em>calculate</em> p-values based on <em>real</em> null distributions, thanks to the random number generators built into coding languages such as <code>R</code>. The practice of generating real null distributions based on your own specific dataset is known as <strong>randomization</strong>.</p>
<p>In a randomization routine, you shuffle the variables in your dataset to generate a distribution of outcomes that would be possible according to a null hypothesis. Most null hypotheses reduce to an expectation of <em>no meaningful difference</em> between two (or more) samples, which is to say that any differences between those samples are merely the product of random chance. Such randomly generated variability can be simulated easily in <code>R</code>.</p>
<p>Randomization may seem daunting at first, and it does indeed draw upon some of the higher-order skills in your <code>R</code> toolbag (such as custom functions, <code>for</code> loops, and sometimes even the <code>apply()</code> functions), but once you become oriented you will see how intuitive and simple these analyses can be.</p>
<p>The real advantages of randomization, however, are not for the programmer but for the reader. Randomization results are <em>much</em> easier to interpret and more information-rich than frequentist p-values. The advantages are many:</p>
<ol style="list-style-type: decimal">
<li><p>Rather than trusting a black box statistical test with obscure requirements about data distributions, you are performing the test yourself and building the test using your own data. You have more control and accountability, and no more risk of choosing the wrong statistical test. Because you are using your own data to produce the null distribution, you are able to retain the quirks of your own particular dataset; the limitations and inconsistencies in your sampling will be safely propagated into the statistic and properly reflected in the ucertainty of your results.</p></li>
<li><p>The interpretation of your p-value will be more intuitive. Rather than saying that some result is or is not significant based upon an arbitrary threshold such as 0.05, you can speak about the <em>chances</em> of meaningful results: “There is a 89% chance that these two sample sets are meaningfully different.” “There is a 92% chance that this trend is increasing.” These kinds of results are easier to interpret, and it avoids the need to make sense of p-values.</p></li>
<li><p>Finally, your statistical test returns much more than a p-value; it returns the null distribution too, which can be of enormous value in more complicated statistical analyses.</p></li>
</ol>
<div id="generalized-randomization-workflow" class="section level3 unnumbered">
<h3>Generalized randomization workflow</h3>
<ol style="list-style-type: decimal">
<li><p>Define your <strong>research question.</strong></p></li>
<li><p>Define the <strong>null model</strong> that you wish to compare your observations against. This involves determining which variable you will need to shuffle.</p></li>
<li><p><strong>Create a function</strong> that calculates the value of interest.</p></li>
<li><p>Use that function to determine the <strong>observed value</strong> of interest.</p></li>
<li><p>Use a <code>for</code> loop to <strong>build a null distribution</strong> by shuffling your observations with <code>R</code>’s random number generators.</p></li>
<li><p><strong>Visualize</strong> your results to sanity-check what you are finding.</p></li>
<li><p>Calculate your <strong>p-value</strong>, by asking what proportion of the null distribution falls below the observed value.</p></li>
</ol>
<p>The examples below will show you how to appy this generalized workflow. Note that we are purposefully applying randomization to scenarios in which classic statistical tests, such as t-tests and linear models, could also be used. We do so because those scenarios are relatively simple, they demonstrate the comparability of randomization to approaches you may already be familiar with, and they hint at the advantages of randomization over those other approaches. But the true value of randomization lies in its ability to carry out statistics when all other conventional tests fail; we hint at that value in the final use case.</p>
</div>
</div>
<div id="common-use-cases" class="section level2 unnumbered">
<h2>Common use cases</h2>
<div id="is-outcome-x-significantly-unexpected" class="section level3 unnumbered">
<h3>1. Is outcome <code>X</code> significantly unexpected?</h3>
<p>To practice this use case, let’s use the dataset <a href="https://github.com/databrew/intro-to-data-science/blob/main/data/humpback-whales.csv?raw=true"><code>humpback-whales.csv</code></a>: 15 years of sightings of humpback whales within a fjord system in northern British Columbia, Canada (<a href="www.bcwhales.org">www.bcwhales.org</a>).</p>
<div class="sourceCode" id="cb490"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb490-1"><a href="randomization-statistics.html#cb490-1"></a><span class="co"># Use dataset</span></span>
<span id="cb490-2"><a href="randomization-statistics.html#cb490-2"></a>hw &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;./data/humpback-whales.csv&quot;</span>)</span></code></pre></div>
<p>Each individual whale in this dataset was identified using unique patterns on its tail, so each whale has an ID number.</p>
<div class="sourceCode" id="cb491"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb491-1"><a href="randomization-statistics.html#cb491-1"></a><span class="kw">nrow</span>(hw)</span></code></pre></div>
<pre><code>[1] 4436</code></pre>
<div class="sourceCode" id="cb493"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb493-1"><a href="randomization-statistics.html#cb493-1"></a><span class="kw">head</span>(hw)</span></code></pre></div>
<pre><code>  year        sit  bhvr  id
1 2004 2004070701   BNF  42
2 2004 2004071401   BNF  42
3 2004 2004071401   BNF  59
4 2004 2004080301   BNF  30
5 2004 2004080401 MI-FE 106
6 2004 2004080401 MI-FE 114</code></pre>
<p>Each row shows a whale (column <code>id</code>) identified during a single sghting (column <code>sit</code>). Some sightings were of a single solo individual, but others were of groups of two or more individuals.</p>
<p>Our interest here is in these whales’ social behavior: do they have “friendships”, i.e., certain individuals that they prefer to associate with over others, or are they just randomly swimming around and bumping into one another?</p>
<p>Let’s tackle this one step at a time.</p>
<p><strong>Step 1:</strong> Our <strong>research question</strong> is, <em>Do any pairs of whales occur together an unexpectedly persistent social bonds?</em> Since in science we are always limited by how well we sample the population of interest, a more precise version of our research question would be this: <em>Based on this dataset, can we conclude whether or not any pairs of whales occur together an unexpectedly large number of times?</em></p>
<p><strong>Step 2:</strong> The <strong>null model</strong> for this question is simple random mixing: there is no pattern to which whales occur in which group. So the variable that we will need to shuffle is the <code>id</code> column. With this approach, we be able to preserve the number of times each individual is seen and the total number of observations. So the limitations and inconsistencies in our sampling of each individual will be safely propagated into our statistics and properly reflected in the uncertainty of our results.</p>
<p><strong>Step 3:</strong> So we need <strong>a function</strong> that returns the number of times two whales are associated. We will call this function <code>association_tally()</code>.</p>
<div class="sourceCode" id="cb495"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb495-1"><a href="randomization-statistics.html#cb495-1"></a>association_tally &lt;-<span class="st"> </span><span class="cf">function</span>(hw,A,B){</span>
<span id="cb495-2"><a href="randomization-statistics.html#cb495-2"></a>  siti &lt;-<span class="st"> </span>hw<span class="op">$</span>sit[hw<span class="op">$</span>id<span class="op">==</span>A]</span>
<span id="cb495-3"><a href="randomization-statistics.html#cb495-3"></a>  sitj &lt;-<span class="st"> </span>hw<span class="op">$</span>sit[hw<span class="op">$</span>id<span class="op">==</span>B]</span>
<span id="cb495-4"><a href="randomization-statistics.html#cb495-4"></a></span>
<span id="cb495-5"><a href="randomization-statistics.html#cb495-5"></a>  common_sits &lt;-<span class="st"> </span><span class="kw">which</span>(siti <span class="op">%in%</span><span class="st"> </span>sitj)</span>
<span id="cb495-6"><a href="randomization-statistics.html#cb495-6"></a>  X &lt;-<span class="st"> </span><span class="kw">length</span>(common_sits)</span>
<span id="cb495-7"><a href="randomization-statistics.html#cb495-7"></a></span>
<span id="cb495-8"><a href="randomization-statistics.html#cb495-8"></a>  <span class="kw">return</span>(X)</span>
<span id="cb495-9"><a href="randomization-statistics.html#cb495-9"></a>}</span></code></pre></div>
<p><strong>Step 4:</strong> For our <strong>observed</strong> association tally, we will focus in on a single pair of humpback whales: IDs 59 and 11.</p>
<div class="sourceCode" id="cb496"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb496-1"><a href="randomization-statistics.html#cb496-1"></a>obs &lt;-<span class="st"> </span><span class="kw">association_tally</span>(hw,<span class="dt">A=</span><span class="st">&quot;59&quot;</span>,<span class="dt">B=</span><span class="st">&quot;11&quot;</span>)</span>
<span id="cb496-2"><a href="randomization-statistics.html#cb496-2"></a>obs</span></code></pre></div>
<pre><code>[1] 71</code></pre>
<p>That’s alot of associations! Let’s see if that observation is statistically significant:</p>
<p><strong>Step 5:</strong> The <strong><code>for</code> loop</strong> for our null distribution will look like this:</p>
<div class="sourceCode" id="cb498"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb498-1"><a href="randomization-statistics.html#cb498-1"></a>nulls &lt;-<span class="st"> </span><span class="kw">c</span>()</span>
<span id="cb498-2"><a href="randomization-statistics.html#cb498-2"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">1000</span>){</span>
<span id="cb498-3"><a href="randomization-statistics.html#cb498-3"></a>  hw_null &lt;-<span class="st"> </span>hw <span class="co"># save a safe copy of the data</span></span>
<span id="cb498-4"><a href="randomization-statistics.html#cb498-4"></a>  hw_null<span class="op">$</span>id &lt;-<span class="st"> </span><span class="kw">sample</span>(hw_null<span class="op">$</span>id,<span class="dt">size=</span><span class="kw">nrow</span>(hw_null),<span class="dt">replace=</span><span class="ot">FALSE</span>) <span class="co"># shuffle the null variable</span></span>
<span id="cb498-5"><a href="randomization-statistics.html#cb498-5"></a>  nulli &lt;-<span class="st"> </span><span class="kw">association_tally</span>(hw_null,<span class="dt">A=</span><span class="st">&quot;59&quot;</span>,<span class="dt">B=</span><span class="st">&quot;11&quot;</span>) <span class="co"># determine null rate for this iteration</span></span>
<span id="cb498-6"><a href="randomization-statistics.html#cb498-6"></a>  nulls[i] &lt;-<span class="st"> </span>nulli <span class="co"># save result</span></span>
<span id="cb498-7"><a href="randomization-statistics.html#cb498-7"></a>}</span></code></pre></div>
<p><em>Note!</em> Here we only iterate our <code>for</code> loop 1,000 times, but most published randomizations are run for 5,000 to 10,000 iterations, just to ensure that the null distribution is adequately unbiased.</p>
<p><strong>Step 6:</strong> To <strong>visualize these results</strong>, use a histogram:</p>
<div class="sourceCode" id="cb499"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb499-1"><a href="randomization-statistics.html#cb499-1"></a><span class="kw">par</span>(<span class="dt">mar=</span><span class="kw">c</span>(<span class="fl">4.2</span>,<span class="fl">4.2</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb499-2"><a href="randomization-statistics.html#cb499-2"></a><span class="kw">hist</span>(nulls,<span class="dt">breaks=</span><span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">25</span>,<span class="dt">by=</span><span class="dv">1</span>),<span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">0</span>,(obs<span class="op">+</span><span class="dv">10</span>)),<span class="dt">main=</span><span class="ot">NULL</span>,<span class="dt">xlab=</span><span class="st">&quot;Null distribution&quot;</span>)</span>
<span id="cb499-3"><a href="randomization-statistics.html#cb499-3"></a><span class="kw">abline</span>(<span class="dt">v=</span>obs,<span class="dt">lwd=</span><span class="dv">2</span>,<span class="dt">lty=</span><span class="dv">3</span>,<span class="dt">col=</span><span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
<p><img src="figures/unnamed-chunk-262-1.png" width="925.44" /></p>
<p><strong>Step 7:</strong> Finally, we <strong>calculate our p-value</strong>:</p>
<div class="sourceCode" id="cb500"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb500-1"><a href="randomization-statistics.html#cb500-1"></a>p_value &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">which</span>(nulls <span class="op">&gt;=</span><span class="st"> </span>obs)) <span class="op">/</span><span class="st"> </span><span class="kw">length</span>(nulls)</span>
<span id="cb500-2"><a href="randomization-statistics.html#cb500-2"></a>p_value</span></code></pre></div>
<pre><code>[1] 0</code></pre>
<p>Let’s do this again with a different humpback pair, IDs 16 and 118, who were seen together only 13 times. Is their association rate statistically significant?</p>
<div class="sourceCode" id="cb502"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb502-1"><a href="randomization-statistics.html#cb502-1"></a><span class="co"># Individual IDs</span></span>
<span id="cb502-2"><a href="randomization-statistics.html#cb502-2"></a>A &lt;-<span class="st"> &quot;58&quot;</span></span>
<span id="cb502-3"><a href="randomization-statistics.html#cb502-3"></a>B &lt;-<span class="st"> &quot;133&quot;</span></span>
<span id="cb502-4"><a href="randomization-statistics.html#cb502-4"></a></span>
<span id="cb502-5"><a href="randomization-statistics.html#cb502-5"></a><span class="co"># Observed association rate</span></span>
<span id="cb502-6"><a href="randomization-statistics.html#cb502-6"></a>obs &lt;-<span class="st"> </span><span class="kw">association_tally</span>(hw,<span class="dt">A=</span>A,<span class="dt">B=</span>B)</span>
<span id="cb502-7"><a href="randomization-statistics.html#cb502-7"></a>obs</span></code></pre></div>
<pre><code>[1] 9</code></pre>
<div class="sourceCode" id="cb504"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb504-1"><a href="randomization-statistics.html#cb504-1"></a><span class="co"># Generate null model</span></span>
<span id="cb504-2"><a href="randomization-statistics.html#cb504-2"></a>nulls &lt;-<span class="st"> </span><span class="kw">c</span>()</span>
<span id="cb504-3"><a href="randomization-statistics.html#cb504-3"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">1000</span>){</span>
<span id="cb504-4"><a href="randomization-statistics.html#cb504-4"></a>  hw_null &lt;-<span class="st"> </span>hw</span>
<span id="cb504-5"><a href="randomization-statistics.html#cb504-5"></a>  hw_null<span class="op">$</span>id &lt;-<span class="st"> </span><span class="kw">sample</span>(hw_null<span class="op">$</span>id,<span class="dt">size=</span><span class="kw">nrow</span>(hw_null),<span class="dt">replace=</span><span class="ot">FALSE</span>)</span>
<span id="cb504-6"><a href="randomization-statistics.html#cb504-6"></a>  nulli &lt;-<span class="st"> </span><span class="kw">association_tally</span>(hw_null,<span class="dt">A=</span>A,<span class="dt">B=</span>B)</span>
<span id="cb504-7"><a href="randomization-statistics.html#cb504-7"></a>  nulls[i] &lt;-<span class="st"> </span>nulli</span>
<span id="cb504-8"><a href="randomization-statistics.html#cb504-8"></a>}</span>
<span id="cb504-9"><a href="randomization-statistics.html#cb504-9"></a></span>
<span id="cb504-10"><a href="randomization-statistics.html#cb504-10"></a><span class="co"># Visualize</span></span>
<span id="cb504-11"><a href="randomization-statistics.html#cb504-11"></a><span class="kw">hist</span>(nulls,<span class="dt">breaks=</span><span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">20</span>,<span class="dt">by=</span><span class="dv">1</span>),<span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">0</span>,(obs<span class="op">+</span><span class="dv">7</span>)),<span class="dt">main=</span><span class="ot">NULL</span>,<span class="dt">xlab=</span><span class="st">&quot;Null distribution&quot;</span>)</span>
<span id="cb504-12"><a href="randomization-statistics.html#cb504-12"></a><span class="kw">abline</span>(<span class="dt">v=</span>obs,<span class="dt">lwd=</span><span class="dv">2</span>,<span class="dt">lty=</span><span class="dv">3</span>,<span class="dt">col=</span><span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
<p><img src="figures/unnamed-chunk-264-1.png" width="925.44" /></p>
<div class="sourceCode" id="cb505"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb505-1"><a href="randomization-statistics.html#cb505-1"></a><span class="co"># Calculate p-value</span></span>
<span id="cb505-2"><a href="randomization-statistics.html#cb505-2"></a>p_value &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">which</span>(nulls <span class="op">&gt;=</span><span class="st"> </span>obs)) <span class="op">/</span><span class="st"> </span><span class="kw">length</span>(nulls)</span>
<span id="cb505-3"><a href="randomization-statistics.html#cb505-3"></a>p_value</span></code></pre></div>
<pre><code>[1] 0.014</code></pre>
<p>In this case, the observed association rate is still statistically significant at the conventional 0.05 level, but there is still an off chance that this is merely the result of random mixing.</p>
</div>
<div id="are-two-sample-sets-significantly-different" class="section level3 unnumbered">
<h3>2. Are two sample sets significantly different?</h3>
<p><em>Building off of the whale scenario:</em> Some of these whales have learned how to practice bubble-net feeding, a remarkable feeding strategy that requires group cooperation and special techniques for catching schooling fish such as herring. Other individuals have never been seen bubble net feeding. Are there any differences how often these two populations – the bubble netters and the “others” – use the study area?</p>
<p>First, let’s see how many of these individuals are known to bubble net feed:</p>
<pre><code>[1] 108</code></pre>
<p>So, out of 132 individuals, 108 are known to practice bubble netting.</p>
<p>Let’s go through the steps:</p>
<p><strong>1. Research question:</strong> Is there any difference in the number of years in which bubble-netters are seen compared to other whales?</p>
<p><strong>2. Null model:</strong> In this case, the null model will be a <em>distribution of average differences</em> in the number of years in which individuals from the two populations are seen. This null distribution will be centered around zero. The variable we will shuffle is which individuals are known bubble netters, keeping the size of the two populations constant in each iteration.</p>
<p><strong>3. Function:</strong></p>
<div class="sourceCode" id="cb508"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb508-1"><a href="randomization-statistics.html#cb508-1"></a>annual_difference &lt;-<span class="st"> </span><span class="cf">function</span>(hw,bnf_ids){</span>
<span id="cb508-2"><a href="randomization-statistics.html#cb508-2"></a>  </span>
<span id="cb508-3"><a href="randomization-statistics.html#cb508-3"></a>  bnf &lt;-<span class="st"> </span>hw[hw<span class="op">$</span>id <span class="op">%in%</span><span class="st"> </span>bnf_ids,] <span class="co"># Sightings of known BNFers</span></span>
<span id="cb508-4"><a href="randomization-statistics.html#cb508-4"></a>  other &lt;-<span class="st"> </span>hw[<span class="op">!</span><span class="st"> </span>hw<span class="op">$</span>id <span class="op">%in%</span><span class="st"> </span>bnf_ids,] <span class="co"># Sightings of other whales</span></span>
<span id="cb508-5"><a href="randomization-statistics.html#cb508-5"></a>  </span>
<span id="cb508-6"><a href="randomization-statistics.html#cb508-6"></a>  <span class="co"># Get distribution of years seen for individuals within each population</span></span>
<span id="cb508-7"><a href="randomization-statistics.html#cb508-7"></a>  counts &lt;-<span class="st"> </span><span class="kw">table</span>(bnf<span class="op">$</span>id,bnf<span class="op">$</span>year) <span class="co"># sightings of each whale (rows) in each year (columns)</span></span>
<span id="cb508-8"><a href="randomization-statistics.html#cb508-8"></a>  n_bnf &lt;-<span class="st"> </span><span class="kw">apply</span>(counts,<span class="dv">1</span>,<span class="cf">function</span>(x){<span class="kw">length</span>(<span class="kw">which</span>(x<span class="op">&gt;</span><span class="dv">0</span>))}) <span class="co"># years seen for each individual</span></span>
<span id="cb508-9"><a href="randomization-statistics.html#cb508-9"></a>  </span>
<span id="cb508-10"><a href="randomization-statistics.html#cb508-10"></a>  counts &lt;-<span class="st"> </span><span class="kw">table</span>(other<span class="op">$</span>id,other<span class="op">$</span>year) <span class="co"># sightings of each whale (rows) in each year (columns)</span></span>
<span id="cb508-11"><a href="randomization-statistics.html#cb508-11"></a>  n_other &lt;-<span class="st"> </span><span class="kw">apply</span>(counts,<span class="dv">1</span>,<span class="cf">function</span>(x){<span class="kw">length</span>(<span class="kw">which</span>(x<span class="op">&gt;</span><span class="dv">0</span>))}) <span class="co"># years seen for each individual</span></span>
<span id="cb508-12"><a href="randomization-statistics.html#cb508-12"></a>  </span>
<span id="cb508-13"><a href="randomization-statistics.html#cb508-13"></a>  <span class="co"># Now get average difference between two distributions</span></span>
<span id="cb508-14"><a href="randomization-statistics.html#cb508-14"></a>  mean_diff &lt;-<span class="st"> </span><span class="kw">mean</span>(n_bnf,<span class="dt">na.rm=</span><span class="ot">TRUE</span>) <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(n_other,<span class="dt">na.rm=</span><span class="ot">TRUE</span>)</span>
<span id="cb508-15"><a href="randomization-statistics.html#cb508-15"></a>  </span>
<span id="cb508-16"><a href="randomization-statistics.html#cb508-16"></a>  <span class="kw">return</span>(mean_diff)</span>
<span id="cb508-17"><a href="randomization-statistics.html#cb508-17"></a>}</span></code></pre></div>
<p><strong>4. Observed value:</strong></p>
<div class="sourceCode" id="cb509"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb509-1"><a href="randomization-statistics.html#cb509-1"></a>obs &lt;-<span class="st"> </span><span class="kw">annual_difference</span>(hw,<span class="dt">bnf_ids=</span>bnf_ids)</span>
<span id="cb509-2"><a href="randomization-statistics.html#cb509-2"></a>obs </span></code></pre></div>
<pre><code>[1] 2.351852</code></pre>
<p><strong>5. Build null distribution:</strong></p>
<div class="sourceCode" id="cb511"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb511-1"><a href="randomization-statistics.html#cb511-1"></a>nulls &lt;-<span class="st"> </span><span class="kw">c</span>()</span>
<span id="cb511-2"><a href="randomization-statistics.html#cb511-2"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">1000</span>){</span>
<span id="cb511-3"><a href="randomization-statistics.html#cb511-3"></a>  bnf_null &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">unique</span>(hw<span class="op">$</span>id),<span class="dt">size=</span><span class="kw">length</span>(bnf_ids),<span class="dt">replace=</span><span class="ot">FALSE</span>)</span>
<span id="cb511-4"><a href="randomization-statistics.html#cb511-4"></a>  nulli &lt;-<span class="st"> </span><span class="kw">annual_difference</span>(hw, <span class="dt">bnf_ids=</span>bnf_null)</span>
<span id="cb511-5"><a href="randomization-statistics.html#cb511-5"></a>  nulls[i] &lt;-<span class="st"> </span>nulli</span>
<span id="cb511-6"><a href="randomization-statistics.html#cb511-6"></a>}</span></code></pre></div>
<p><strong>6. Visualize:</strong></p>
<div class="sourceCode" id="cb512"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb512-1"><a href="randomization-statistics.html#cb512-1"></a><span class="kw">hist</span>(nulls,<span class="dt">breaks=</span><span class="kw">seq</span>(<span class="op">-</span><span class="dv">5</span>,<span class="dv">5</span>,<span class="dt">by=</span>.<span class="dv">1</span>),<span class="dt">xlim=</span><span class="kw">c</span>(<span class="op">-</span><span class="dv">5</span>,<span class="dv">5</span>),<span class="dt">main=</span><span class="ot">NULL</span>,<span class="dt">xlab=</span><span class="st">&quot;Null distribution&quot;</span>)</span>
<span id="cb512-2"><a href="randomization-statistics.html#cb512-2"></a><span class="kw">abline</span>(<span class="dt">v=</span>obs,<span class="dt">lwd=</span><span class="dv">2</span>,<span class="dt">lty=</span><span class="dv">3</span>,<span class="dt">col=</span><span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
<p><img src="figures/unnamed-chunk-270-1.png" width="925.44" /></p>
<p><strong>7. p-value:</strong></p>
<div class="sourceCode" id="cb513"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb513-1"><a href="randomization-statistics.html#cb513-1"></a>p_value &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">which</span>(nulls <span class="op">&gt;=</span><span class="st"> </span>obs)) <span class="op">/</span><span class="st"> </span><span class="kw">length</span>(nulls)</span>
<span id="cb513-2"><a href="randomization-statistics.html#cb513-2"></a>p_value</span></code></pre></div>
<pre><code>[1] 0.001</code></pre>
<p>So there is indeed a significant difference in the annual site fidelity in the two populations! Bubble net feeders practice higher annual return rates than other whales (p = 0.001).</p>
</div>
<div id="are-two-variables-correlated" class="section level3 unnumbered">
<h3>3. Are two variables correlated?</h3>
<p>To perform a correlation analysis with randomization, let’s use a classic scenario from marine conversation: We have abundance estimates for a critically endangered porpoise from four years across two decades of research. This species only has a handful of individuals left in the wild. (<a href="https://github.com/databrew/intro-to-data-science/blob/main/data/porpoise-survey.csv?raw=true">link to dataset</a>)</p>
<div class="sourceCode" id="cb515"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb515-1"><a href="randomization-statistics.html#cb515-1"></a>df &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;./data/porpoise-survey.csv&quot;</span>)</span>
<span id="cb515-2"><a href="randomization-statistics.html#cb515-2"></a><span class="kw">head</span>(df)</span></code></pre></div>
<pre><code>  year         N
1 2000 12.547943
2 2000  5.932797
3 2000 17.291144
4 2000  2.707317
5 2000 12.279161
6 2000  8.945810</code></pre>
<p>Each row of this dataset is an abundance estimate from a survey that occurred within the vaquita’s range during a certain year.</p>
<div class="sourceCode" id="cb517"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb517-1"><a href="randomization-statistics.html#cb517-1"></a><span class="kw">plot</span>(df<span class="op">$</span>N <span class="op">~</span><span class="st"> </span>df<span class="op">$</span>year,<span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">20</span>),</span>
<span id="cb517-2"><a href="randomization-statistics.html#cb517-2"></a>     <span class="dt">xlab=</span><span class="st">&quot;Year&quot;</span>,</span>
<span id="cb517-3"><a href="randomization-statistics.html#cb517-3"></a>     <span class="dt">ylab=</span><span class="st">&quot;Total Abundance&quot;</span>,</span>
<span id="cb517-4"><a href="randomization-statistics.html#cb517-4"></a>     <span class="dt">col=</span><span class="kw">adjustcolor</span>(<span class="st">&quot;black&quot;</span>,<span class="dt">alpha.f=</span>.<span class="dv">6</span>))</span></code></pre></div>
<p><img src="figures/unnamed-chunk-274-1.png" width="925.44" /></p>
<p>Performing a simple linear regression with this dataset yields the following results:</p>
<p><img src="figures/unnamed-chunk-275-1.png" width="925.44" /></p>
<p>The slope appears to be negative, but the regression has a non-significant p-value (p=0.22) and a very small correlation coefficient:</p>
<div class="sourceCode" id="cb518"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb518-1"><a href="randomization-statistics.html#cb518-1"></a><span class="kw">summary</span>(df_lm)</span></code></pre></div>
<pre><code>
Call:
lm(formula = df$N ~ df$year)

Residuals:
    Min      1Q  Median      3Q     Max 
-7.6841 -3.3981 -0.3879  3.0338  8.6945 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)
(Intercept) 173.63645  133.70824   1.299    0.198
df$year      -0.08216    0.06657  -1.234    0.221

Residual standard error: 4.221 on 82 degrees of freedom
Multiple R-squared:  0.01824,   Adjusted R-squared:  0.006268 
F-statistic: 1.523 on 1 and 82 DF,  p-value: 0.2206</code></pre>
<p>These results may compel some conservation skeptics to stop worrying about the porpoise. “Yes, the population is small, but it appears stable, and there is no evidence that it is decreasing.” This is a situation in which using a randomization regression analysis could give us more information and help us speak more precisely about the risks to which this population is exposed.</p>
<p>Let’s go through the steps:</p>
<p><strong>1. Research question:</strong> Is there a trend in porpoise abundance over time?</p>
<p><strong>2. Null model:</strong> There is no trend; the abundance estimates might as well come from any given year and the trendline would look the same.</p>
<p><strong>3. Function:</strong> Get the slope estimate for the time series.</p>
<div class="sourceCode" id="cb520"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb520-1"><a href="randomization-statistics.html#cb520-1"></a>df_lm &lt;-<span class="st"> </span><span class="cf">function</span>(df){</span>
<span id="cb520-2"><a href="randomization-statistics.html#cb520-2"></a>  lmi &lt;-<span class="st"> </span><span class="kw">lm</span>(df<span class="op">$</span>N <span class="op">~</span><span class="st"> </span>df<span class="op">$</span>year) </span>
<span id="cb520-3"><a href="randomization-statistics.html#cb520-3"></a>  slopi &lt;-<span class="st"> </span><span class="kw">summary</span>(lmi)<span class="op">$</span>coefficients[<span class="dv">2</span>,<span class="dv">1</span>]</span>
<span id="cb520-4"><a href="randomization-statistics.html#cb520-4"></a>  rsqu &lt;-<span class="st"> </span><span class="kw">summary</span>(lmi)<span class="op">$</span>r.squared</span>
<span id="cb520-5"><a href="randomization-statistics.html#cb520-5"></a>  </span>
<span id="cb520-6"><a href="randomization-statistics.html#cb520-6"></a>  <span class="kw">return</span>(<span class="kw">c</span>(<span class="st">&quot;slope&quot;</span>=slopi,<span class="st">&quot;r&quot;</span>=rsqu))</span>
<span id="cb520-7"><a href="randomization-statistics.html#cb520-7"></a>}</span></code></pre></div>
<p><strong>4. Observed value:</strong></p>
<div class="sourceCode" id="cb521"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb521-1"><a href="randomization-statistics.html#cb521-1"></a>obs &lt;-<span class="st"> </span><span class="kw">df_lm</span>(df)</span>
<span id="cb521-2"><a href="randomization-statistics.html#cb521-2"></a>obs </span></code></pre></div>
<pre><code>      slope           r 
-0.08216195  0.01824031 </code></pre>
<p><strong>5. Build null distribution:</strong></p>
<div class="sourceCode" id="cb523"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb523-1"><a href="randomization-statistics.html#cb523-1"></a>nulls &lt;-<span class="st"> </span><span class="kw">data.frame</span>()</span>
<span id="cb523-2"><a href="randomization-statistics.html#cb523-2"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">1000</span>){</span>
<span id="cb523-3"><a href="randomization-statistics.html#cb523-3"></a>  df_null &lt;-<span class="st"> </span>df</span>
<span id="cb523-4"><a href="randomization-statistics.html#cb523-4"></a>  df_null<span class="op">$</span>year &lt;-<span class="st"> </span><span class="kw">sample</span>(df_null<span class="op">$</span>year,<span class="dt">size=</span><span class="kw">nrow</span>(df_null),<span class="dt">replace=</span><span class="ot">FALSE</span>)</span>
<span id="cb523-5"><a href="randomization-statistics.html#cb523-5"></a>  nulli &lt;-<span class="st"> </span><span class="kw">df_lm</span>(df_null)</span>
<span id="cb523-6"><a href="randomization-statistics.html#cb523-6"></a>  nulli &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">slope=</span>nulli[<span class="dv">1</span>],<span class="dt">r=</span>nulli[<span class="dv">2</span>])</span>
<span id="cb523-7"><a href="randomization-statistics.html#cb523-7"></a>  nulls &lt;-<span class="st"> </span><span class="kw">rbind</span>(nulls,nulli)</span>
<span id="cb523-8"><a href="randomization-statistics.html#cb523-8"></a>}</span></code></pre></div>
<p><strong>6. Visualize:</strong></p>
<div class="sourceCode" id="cb524"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb524-1"><a href="randomization-statistics.html#cb524-1"></a><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb524-2"><a href="randomization-statistics.html#cb524-2"></a><span class="kw">hist</span>(nulls<span class="op">$</span>slope,<span class="dt">breaks=</span><span class="kw">seq</span>(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="dt">by=</span>.<span class="dv">01</span>),<span class="dt">xlim=</span><span class="kw">c</span>(<span class="op">-</span>.<span class="dv">5</span>,.<span class="dv">5</span>),<span class="dt">main=</span><span class="ot">NULL</span>,<span class="dt">xlab=</span><span class="st">&quot;Null distribution&quot;</span>,<span class="dt">border=</span><span class="st">&quot;grey70&quot;</span>)</span>
<span id="cb524-3"><a href="randomization-statistics.html#cb524-3"></a><span class="kw">text</span>(<span class="op">-</span>.<span class="dv">48</span>,<span class="dv">20</span>,<span class="st">&quot;Slope </span><span class="ch">\n</span><span class="st">estimate&quot;</span>,<span class="dt">pos=</span><span class="dv">4</span>)</span>
<span id="cb524-4"><a href="randomization-statistics.html#cb524-4"></a><span class="kw">abline</span>(<span class="dt">v=</span>obs[<span class="dv">1</span>],<span class="dt">lwd=</span><span class="dv">2</span>,<span class="dt">lty=</span><span class="dv">3</span>,<span class="dt">col=</span><span class="st">&quot;blue&quot;</span>)</span>
<span id="cb524-5"><a href="randomization-statistics.html#cb524-5"></a></span>
<span id="cb524-6"><a href="randomization-statistics.html#cb524-6"></a><span class="kw">hist</span>(nulls<span class="op">$</span>r,<span class="dt">breaks=</span><span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dt">by=</span>.<span class="dv">001</span>),<span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">0</span>,.<span class="dv">1</span>),<span class="dt">main=</span><span class="ot">NULL</span>,<span class="dt">xlab=</span><span class="st">&quot;Null distribution&quot;</span>,<span class="dt">border=</span><span class="st">&quot;grey70&quot;</span>)</span>
<span id="cb524-7"><a href="randomization-statistics.html#cb524-7"></a><span class="kw">text</span>(.<span class="dv">06</span>,<span class="dv">20</span>,<span class="st">&quot;Correlation </span><span class="ch">\n</span><span class="st">coefficient&quot;</span>,<span class="dt">pos=</span><span class="dv">4</span>)</span>
<span id="cb524-8"><a href="randomization-statistics.html#cb524-8"></a><span class="kw">abline</span>(<span class="dt">v=</span>obs[<span class="dv">2</span>],<span class="dt">lwd=</span><span class="dv">2</span>,<span class="dt">lty=</span><span class="dv">3</span>,<span class="dt">col=</span><span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
<p><img src="figures/unnamed-chunk-280-1.png" width="672" /></p>
<p><strong>7. p-value:</strong></p>
<p>Significance of <strong>slope</strong>:</p>
<div class="sourceCode" id="cb525"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb525-1"><a href="randomization-statistics.html#cb525-1"></a>p_value &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">which</span>(nulls<span class="op">$</span>slope <span class="op">&gt;=</span><span class="st"> </span>obs[<span class="dv">1</span>])) <span class="op">/</span><span class="st"> </span><span class="kw">nrow</span>(nulls)</span>
<span id="cb525-2"><a href="randomization-statistics.html#cb525-2"></a>p_value</span></code></pre></div>
<pre><code>[1] 0.9</code></pre>
<p>This indicates that the chance that the slope is lower than the null expectation is 90%.</p>
<p>Significance of <strong>correlation coefficient</strong>:</p>
<div class="sourceCode" id="cb527"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb527-1"><a href="randomization-statistics.html#cb527-1"></a>p_value &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">which</span>(nulls<span class="op">$</span>r <span class="op">&gt;=</span><span class="st"> </span>obs[<span class="dv">2</span>])) <span class="op">/</span><span class="st"> </span><span class="kw">nrow</span>(nulls)</span>
<span id="cb527-2"><a href="randomization-statistics.html#cb527-2"></a>p_value</span></code></pre></div>
<pre><code>[1] 0.215</code></pre>
<p>This indicates that the observed regression is better than 78.5% of scenarios that might be expected under the null expectation.</p>
</div>
<div id="is-the-slope-of-a-regression-line-negative" class="section level3 unnumbered">
<h3>4. Is the slope of a regression line negative?</h3>
<p>Sometimes we have even less data about an endagered species. Let’s say we go out in 2021 for another porpoise survey and come up with these estimates from the species’ range:</p>
<div class="sourceCode" id="cb529"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb529-1"><a href="randomization-statistics.html#cb529-1"></a><span class="kw">library</span>(truncnorm) ; <span class="kw">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb529-2"><a href="randomization-statistics.html#cb529-2"></a>n2021 &lt;-<span class="st"> </span><span class="kw">rtruncnorm</span>(<span class="dt">n=</span><span class="dv">25</span>,<span class="dt">a=</span><span class="dv">0</span>,<span class="dt">mean=</span><span class="fl">3.6</span>,<span class="dt">sd=</span><span class="dv">3</span>)</span>
<span id="cb529-3"><a href="randomization-statistics.html#cb529-3"></a>n2021</span></code></pre></div>
<pre><code> [1]  4.4322877  6.8533235  4.8873741  5.1181677  1.8757801  1.9601044
 [7]  1.9066440  0.9298865  2.1684219  0.6048407  1.2712383  3.7933765
[13]  6.4784822  3.2691435  2.0669715  0.8664138  1.0884850 10.8475055
[19]  4.0022647  2.1279423  2.2783564  4.9787683  1.5188393  5.3242672
[25]  0.5290328</code></pre>
<p>We want to know what the chances are that the population has declined between 2017 and 2021.</p>
<div class="sourceCode" id="cb531"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb531-1"><a href="randomization-statistics.html#cb531-1"></a>n2017 &lt;-<span class="st"> </span>df<span class="op">$</span>N[df<span class="op">$</span>year<span class="op">==</span><span class="dv">2017</span>]</span>
<span id="cb531-2"><a href="randomization-statistics.html#cb531-2"></a></span>
<span id="cb531-3"><a href="randomization-statistics.html#cb531-3"></a><span class="kw">plot</span>(<span class="dv">1</span>,<span class="dt">type=</span><span class="st">&quot;n&quot;</span>,<span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">15</span>),<span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">2015</span>,<span class="dv">2023</span>),</span>
<span id="cb531-4"><a href="randomization-statistics.html#cb531-4"></a>     <span class="dt">xlab=</span><span class="st">&quot;Year&quot;</span>,</span>
<span id="cb531-5"><a href="randomization-statistics.html#cb531-5"></a>     <span class="dt">ylab=</span><span class="st">&quot;Total Abundance&quot;</span>,</span>
<span id="cb531-6"><a href="randomization-statistics.html#cb531-6"></a>     <span class="dt">col=</span><span class="kw">adjustcolor</span>(<span class="st">&quot;black&quot;</span>,<span class="dt">alpha.f=</span>.<span class="dv">6</span>))</span>
<span id="cb531-7"><a href="randomization-statistics.html#cb531-7"></a></span>
<span id="cb531-8"><a href="randomization-statistics.html#cb531-8"></a><span class="kw">points</span>(n2017 <span class="op">~</span><span class="st"> </span><span class="kw">rep</span>(<span class="dv">2017</span>,<span class="dt">times=</span><span class="kw">length</span>(n2017)))</span>
<span id="cb531-9"><a href="randomization-statistics.html#cb531-9"></a><span class="kw">points</span>(n2021 <span class="op">~</span><span class="st"> </span><span class="kw">rep</span>(<span class="dv">2021</span>,<span class="dt">times=</span><span class="kw">length</span>(n2021)))</span></code></pre></div>
<p><img src="figures/unnamed-chunk-284-1.png" width="925.44" /></p>
<p>If this is all we have, what can we say about the status of this endangered species? With such a low sample size and so much variability, it can be really hard to produce significant or even compelling results. <strong>Well, what are the chances that this population is in decline?</strong> That is a question that a simple linear model cannot tell us.</p>
<p>In this case, our null model will be the distribution of differences of values drawn randomly from the two years’ datasets.</p>
<p>And in this randomization application, the workflow is a bit more simplified. We don’t need a core function, and we don’t even need a <code>for</code> loop.</p>
<div class="sourceCode" id="cb532"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb532-1"><a href="randomization-statistics.html#cb532-1"></a><span class="co"># Randomly draw from the 2017 dataset 5,000 times</span></span>
<span id="cb532-2"><a href="randomization-statistics.html#cb532-2"></a>r2017 &lt;-<span class="st"> </span><span class="kw">sample</span>(n2017,<span class="dt">size=</span><span class="dv">10000</span>,<span class="dt">replace=</span><span class="ot">TRUE</span>)</span>
<span id="cb532-3"><a href="randomization-statistics.html#cb532-3"></a></span>
<span id="cb532-4"><a href="randomization-statistics.html#cb532-4"></a><span class="co"># Do the same for the 2017 dataset</span></span>
<span id="cb532-5"><a href="randomization-statistics.html#cb532-5"></a>r2021 &lt;-<span class="st"> </span><span class="kw">sample</span>(n2021,<span class="dt">size=</span><span class="dv">10000</span>,<span class="dt">replace=</span><span class="ot">TRUE</span>)</span>
<span id="cb532-6"><a href="randomization-statistics.html#cb532-6"></a></span>
<span id="cb532-7"><a href="randomization-statistics.html#cb532-7"></a><span class="co"># Get the difference of these two datasets</span></span>
<span id="cb532-8"><a href="randomization-statistics.html#cb532-8"></a>diffs &lt;-<span class="st"> </span>r2021 <span class="op">-</span><span class="st"> </span>r2017</span>
<span id="cb532-9"><a href="randomization-statistics.html#cb532-9"></a></span>
<span id="cb532-10"><a href="randomization-statistics.html#cb532-10"></a><span class="co"># Visualize</span></span>
<span id="cb532-11"><a href="randomization-statistics.html#cb532-11"></a><span class="kw">hist</span>(diffs,<span class="dt">breaks=</span><span class="kw">seq</span>(<span class="op">-</span><span class="dv">20</span>,<span class="dv">20</span>,<span class="dt">by=</span><span class="dv">1</span>),<span class="dt">xlim=</span><span class="kw">c</span>(<span class="op">-</span><span class="dv">20</span>,<span class="dv">20</span>),<span class="dt">main=</span><span class="ot">NULL</span>,<span class="dt">xlab=</span><span class="st">&quot;Null distribution&quot;</span>,<span class="dt">border=</span><span class="st">&quot;grey70&quot;</span>)</span>
<span id="cb532-12"><a href="randomization-statistics.html#cb532-12"></a><span class="kw">abline</span>(<span class="dt">v=</span><span class="dv">0</span>,<span class="dt">lwd=</span><span class="dv">2</span>,<span class="dt">lty=</span><span class="dv">3</span>,<span class="dt">col=</span><span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
<p><img src="figures/unnamed-chunk-285-1.png" width="925.44" /></p>
<div class="sourceCode" id="cb533"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb533-1"><a href="randomization-statistics.html#cb533-1"></a><span class="co"># Get p_value</span></span>
<span id="cb533-2"><a href="randomization-statistics.html#cb533-2"></a>p_value &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">which</span>(diffs <span class="op">&gt;=</span><span class="st"> </span><span class="dv">0</span>)) <span class="op">/</span><span class="st"> </span><span class="kw">length</span>(diffs)</span>
<span id="cb533-3"><a href="randomization-statistics.html#cb533-3"></a></span>
<span id="cb533-4"><a href="randomization-statistics.html#cb533-4"></a><span class="co"># Convert to chances of decline</span></span>
<span id="cb533-5"><a href="randomization-statistics.html#cb533-5"></a>chances_of_decline &lt;-<span class="st"> </span><span class="dv">100</span><span class="op">*</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>p_value)</span>
<span id="cb533-6"><a href="randomization-statistics.html#cb533-6"></a>chances_of_decline</span></code></pre></div>
<pre><code>[1] 84.43</code></pre>
<p>The chances that this population is in decline is 84.43%.</p>
</div>
</div>
<div id="review-assignment-11" class="section level2 unnumbered">
<h2>Review assignment</h2>
<p>Let’s return to the humpback whale scenario</p>
<div id="a-do-bubble-net-feeders-have-stronger-social-bonds" class="section level3 unnumbered">
<h3>(a) Do bubble net feeders have stronger social bonds?</h3>
<p>Above we asked whether bubble net feeders exhibit higher year-to-year site fidelity to the study area than other individuals. What about their social bonds? Do whales known to bubble net feed tend to have more stable social associations than the others?</p>
<p>Make sure you are working with the correct data:</p>
<div class="sourceCode" id="cb535"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb535-1"><a href="randomization-statistics.html#cb535-1"></a>hw &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;./data/humpback-whales.csv&quot;</span>)</span>
<span id="cb535-2"><a href="randomization-statistics.html#cb535-2"></a></span>
<span id="cb535-3"><a href="randomization-statistics.html#cb535-3"></a><span class="co"># Establish the two populations</span></span>
<span id="cb535-4"><a href="randomization-statistics.html#cb535-4"></a>bnf_indices &lt;-<span class="st"> </span><span class="kw">grep</span>(<span class="st">&quot;BNF&quot;</span>,hw<span class="op">$</span>bhvr) <span class="co"># which detections are of BNFers</span></span>
<span id="cb535-5"><a href="randomization-statistics.html#cb535-5"></a>bnf_sits &lt;-<span class="st"> </span>hw[bnf_indices,] <span class="co"># BNF sightings</span></span>
<span id="cb535-6"><a href="randomization-statistics.html#cb535-6"></a>bnf_ids &lt;-<span class="st"> </span><span class="kw">unique</span>(bnf_sits<span class="op">$</span>id) <span class="co"># BNF individuals</span></span>
<span id="cb535-7"><a href="randomization-statistics.html#cb535-7"></a><span class="kw">length</span>(bnf_ids)</span></code></pre></div>
<pre><code>[1] 108</code></pre>
<p><strong>Answer key:</strong></p>
<div class="sourceCode" id="cb537"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb537-1"><a href="randomization-statistics.html#cb537-1"></a><span class="co"># Internal function for determining times seen together for a single row of a dyads dataframe</span></span>
<span id="cb537-2"><a href="randomization-statistics.html#cb537-2"></a>social_X &lt;-<span class="st"> </span><span class="cf">function</span>(dyad){</span>
<span id="cb537-3"><a href="randomization-statistics.html#cb537-3"></a>    A &lt;-<span class="st"> </span>dyad[<span class="dv">1</span>]</span>
<span id="cb537-4"><a href="randomization-statistics.html#cb537-4"></a>    B &lt;-<span class="st"> </span>dyad[<span class="dv">2</span>]</span>
<span id="cb537-5"><a href="randomization-statistics.html#cb537-5"></a>    sitA &lt;-<span class="st"> </span>hw<span class="op">$</span>sit[hw<span class="op">$</span>id<span class="op">==</span>A]</span>
<span id="cb537-6"><a href="randomization-statistics.html#cb537-6"></a>    sitB &lt;-<span class="st"> </span>hw<span class="op">$</span>sit[hw<span class="op">$</span>id<span class="op">==</span>B]</span>
<span id="cb537-7"><a href="randomization-statistics.html#cb537-7"></a>    X &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">which</span>(sitA <span class="op">%in%</span><span class="st"> </span>sitB))</span>
<span id="cb537-8"><a href="randomization-statistics.html#cb537-8"></a>    <span class="kw">return</span>(X)</span>
<span id="cb537-9"><a href="randomization-statistics.html#cb537-9"></a>}</span>
<span id="cb537-10"><a href="randomization-statistics.html#cb537-10"></a></span>
<span id="cb537-11"><a href="randomization-statistics.html#cb537-11"></a><span class="co"># Core function</span></span>
<span id="cb537-12"><a href="randomization-statistics.html#cb537-12"></a>social_difference &lt;-<span class="st"> </span><span class="cf">function</span>(hw,bnf_ids){</span>
<span id="cb537-13"><a href="randomization-statistics.html#cb537-13"></a>  </span>
<span id="cb537-14"><a href="randomization-statistics.html#cb537-14"></a>  bnf &lt;-<span class="st"> </span>hw[hw<span class="op">$</span>id <span class="op">%in%</span><span class="st"> </span>bnf_ids,] <span class="co"># Sightings of known BNFers</span></span>
<span id="cb537-15"><a href="randomization-statistics.html#cb537-15"></a>  other &lt;-<span class="st"> </span>hw[<span class="op">!</span><span class="st"> </span>hw<span class="op">$</span>id <span class="op">%in%</span><span class="st"> </span>bnf_ids,] <span class="co"># Sightings of other whales</span></span>
<span id="cb537-16"><a href="randomization-statistics.html#cb537-16"></a>  other_ids &lt;-<span class="st"> </span><span class="kw">unique</span>(other<span class="op">$</span>id)</span>
<span id="cb537-17"><a href="randomization-statistics.html#cb537-17"></a>  </span>
<span id="cb537-18"><a href="randomization-statistics.html#cb537-18"></a>  bnfs &lt;-<span class="st"> </span><span class="kw">expand.grid</span>(bnf_ids,bnf_ids) <span class="co"># Make a dataframe of all possible dyad combinations</span></span>
<span id="cb537-19"><a href="randomization-statistics.html#cb537-19"></a>  bnfs<span class="op">$</span>X &lt;-<span class="st"> </span><span class="kw">apply</span>(bnfs,<span class="dv">1</span>,social_X) <span class="co"># Get number of times seen</span></span>
<span id="cb537-20"><a href="randomization-statistics.html#cb537-20"></a>  </span>
<span id="cb537-21"><a href="randomization-statistics.html#cb537-21"></a>  <span class="co"># Do same for others</span></span>
<span id="cb537-22"><a href="randomization-statistics.html#cb537-22"></a>  others &lt;-<span class="st"> </span><span class="kw">expand.grid</span>(other_ids, other_ids)</span>
<span id="cb537-23"><a href="randomization-statistics.html#cb537-23"></a>  others<span class="op">$</span>X &lt;-<span class="st"> </span><span class="kw">apply</span>(others,<span class="dv">1</span>,social_X) </span>
<span id="cb537-24"><a href="randomization-statistics.html#cb537-24"></a>  </span>
<span id="cb537-25"><a href="randomization-statistics.html#cb537-25"></a>  <span class="co"># Now get average difference between two distributions</span></span>
<span id="cb537-26"><a href="randomization-statistics.html#cb537-26"></a>  mean_diff &lt;-<span class="st"> </span><span class="kw">mean</span>(bnfs<span class="op">$</span>X,<span class="dt">na.rm=</span><span class="ot">TRUE</span>) <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(others<span class="op">$</span>X,<span class="dt">na.rm=</span><span class="ot">TRUE</span>)</span>
<span id="cb537-27"><a href="randomization-statistics.html#cb537-27"></a>  </span>
<span id="cb537-28"><a href="randomization-statistics.html#cb537-28"></a>  <span class="kw">return</span>(mean_diff)</span>
<span id="cb537-29"><a href="randomization-statistics.html#cb537-29"></a>}</span>
<span id="cb537-30"><a href="randomization-statistics.html#cb537-30"></a></span>
<span id="cb537-31"><a href="randomization-statistics.html#cb537-31"></a><span class="co"># Observed</span></span>
<span id="cb537-32"><a href="randomization-statistics.html#cb537-32"></a>obs &lt;-<span class="st"> </span><span class="kw">social_difference</span>(hw,bnf_ids)</span>
<span id="cb537-33"><a href="randomization-statistics.html#cb537-33"></a>obs</span>
<span id="cb537-34"><a href="randomization-statistics.html#cb537-34"></a></span>
<span id="cb537-35"><a href="randomization-statistics.html#cb537-35"></a><span class="co"># Null distribution (only do 100 iterations for sake of time)</span></span>
<span id="cb537-36"><a href="randomization-statistics.html#cb537-36"></a>nulls &lt;-<span class="st"> </span><span class="kw">c</span>()</span>
<span id="cb537-37"><a href="randomization-statistics.html#cb537-37"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">100</span>){</span>
<span id="cb537-38"><a href="randomization-statistics.html#cb537-38"></a>  bnf_null &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">unique</span>(hw<span class="op">$</span>id),<span class="dt">size=</span><span class="kw">length</span>(bnf_ids),<span class="dt">replace=</span><span class="ot">FALSE</span>)</span>
<span id="cb537-39"><a href="randomization-statistics.html#cb537-39"></a>  nulli &lt;-<span class="st"> </span><span class="kw">social_difference</span>(hw, <span class="dt">bnf_ids=</span>bnf_null)</span>
<span id="cb537-40"><a href="randomization-statistics.html#cb537-40"></a>  nulls[i] &lt;-<span class="st"> </span>nulli</span>
<span id="cb537-41"><a href="randomization-statistics.html#cb537-41"></a>}</span>
<span id="cb537-42"><a href="randomization-statistics.html#cb537-42"></a></span>
<span id="cb537-43"><a href="randomization-statistics.html#cb537-43"></a><span class="co"># Visualize</span></span>
<span id="cb537-44"><a href="randomization-statistics.html#cb537-44"></a><span class="kw">par</span>(<span class="dt">mar=</span><span class="kw">c</span>(<span class="fl">4.2</span>,<span class="fl">4.2</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb537-45"><a href="randomization-statistics.html#cb537-45"></a><span class="kw">hist</span>(nulls,<span class="dt">breaks=</span><span class="kw">seq</span>(<span class="op">-</span><span class="dv">6</span>,<span class="dv">6</span>,<span class="dt">by=</span>.<span class="dv">1</span>),<span class="dt">xlim=</span><span class="kw">c</span>(<span class="op">-</span><span class="dv">3</span>,<span class="dv">1</span>),<span class="dt">main=</span><span class="ot">NULL</span>,<span class="dt">xlab=</span><span class="st">&quot;Null distribution&quot;</span>)</span>
<span id="cb537-46"><a href="randomization-statistics.html#cb537-46"></a><span class="kw">abline</span>(<span class="dt">v=</span>obs,<span class="dt">lwd=</span><span class="dv">2</span>,<span class="dt">lty=</span><span class="dv">3</span>,<span class="dt">col=</span><span class="st">&quot;blue&quot;</span>)</span>
<span id="cb537-47"><a href="randomization-statistics.html#cb537-47"></a></span>
<span id="cb537-48"><a href="randomization-statistics.html#cb537-48"></a><span class="co"># p-value</span></span>
<span id="cb537-49"><a href="randomization-statistics.html#cb537-49"></a>p_value &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">which</span>(nulls <span class="op">&gt;=</span><span class="st"> </span>obs)) <span class="op">/</span><span class="st"> </span><span class="kw">length</span>(nulls)</span>
<span id="cb537-50"><a href="randomization-statistics.html#cb537-50"></a>p_value</span>
<span id="cb537-51"><a href="randomization-statistics.html#cb537-51"></a></span>
<span id="cb537-52"><a href="randomization-statistics.html#cb537-52"></a><span class="co"># BNFers have much more persistent bonds than other whales (p=0.00000)</span></span></code></pre></div>
</div>
<div id="b-are-bubble-net-feeders-more-closely-related-to-each-other" class="section level3 unnumbered">
<h3>(b) Are bubble net feeders more closely related to each other?</h3>
<p>In 2019, researchers took DNA samples from 36 individuals in this dataset. They collected the samples by flying drones through the whale’s spouts and harvesting DNA from their <em>snot</em>! <em>GROSS!!!</em> But also <em>super RAD!</em></p>
<p>Using these genetic samples, the researchers determined the relatedness of each pair of individuals they sampled. Those results are provided in the dataset <a href="https://github.com/databrew/intro-to-data-science/blob/main/data/humpback-kinship.rds?raw=true"><code>humpback-kinship.rds</code></a>.</p>
<div class="sourceCode" id="cb538"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb538-1"><a href="randomization-statistics.html#cb538-1"></a>kinship &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;./data/humpback-kinship.rds&quot;</span>)</span></code></pre></div>
<p>And <a href="https://github.com/databrew/intro-to-data-science/blob/main/data/bnf-status.rds?raw=true">here is a key</a> providing the IDs of these 36 whales and their status as a known bubble net feeder.</p>
<div class="sourceCode" id="cb539"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb539-1"><a href="randomization-statistics.html#cb539-1"></a>bnf_status &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;./data/bnf-status.rds&quot;</span>)</span></code></pre></div>
<p>Use these datasets within a randomization routine to determine whether known bubble netters are more closely related to each other than they are to other whales.</p>
<p><strong>Answer key:</strong></p>
<div class="sourceCode" id="cb540"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb540-1"><a href="randomization-statistics.html#cb540-1"></a><span class="co"># How many BNFers are in this dataset?</span></span>
<span id="cb540-2"><a href="randomization-statistics.html#cb540-2"></a>n_bnf &lt;-<span class="st"> </span><span class="kw">nrow</span>(bnf_status[bnf_status<span class="op">$</span>bnf,])</span>
<span id="cb540-3"><a href="randomization-statistics.html#cb540-3"></a>n_bnf</span>
<span id="cb540-4"><a href="randomization-statistics.html#cb540-4"></a></span>
<span id="cb540-5"><a href="randomization-statistics.html#cb540-5"></a><span class="co"># Core function</span></span>
<span id="cb540-6"><a href="randomization-statistics.html#cb540-6"></a>kinship_difference &lt;-<span class="st"> </span><span class="cf">function</span>(kinship,bnf_status){</span>
<span id="cb540-7"><a href="randomization-statistics.html#cb540-7"></a>  </span>
<span id="cb540-8"><a href="randomization-statistics.html#cb540-8"></a>  bnf_ids &lt;-<span class="st"> </span>bnf_status<span class="op">$</span>id[bnf_status<span class="op">$</span>bnf]</span>
<span id="cb540-9"><a href="randomization-statistics.html#cb540-9"></a>  other_ids &lt;-<span class="st"> </span>bnf_status<span class="op">$</span>id[<span class="op">!</span><span class="st"> </span>bnf_status<span class="op">$</span>bnf]</span>
<span id="cb540-10"><a href="randomization-statistics.html#cb540-10"></a>  </span>
<span id="cb540-11"><a href="randomization-statistics.html#cb540-11"></a>  bnf_rows &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">row.names</span>(kinship) <span class="op">%in%</span><span class="st"> </span>bnf_ids)</span>
<span id="cb540-12"><a href="randomization-statistics.html#cb540-12"></a>  kin_bnf &lt;-<span class="st"> </span>kinship[bnf_rows,bnf_rows]</span>
<span id="cb540-13"><a href="randomization-statistics.html#cb540-13"></a>  kin_other &lt;-<span class="st"> </span>kinship[<span class="op">-</span>bnf_rows, <span class="op">-</span>bnf_rows]</span>
<span id="cb540-14"><a href="randomization-statistics.html#cb540-14"></a>  </span>
<span id="cb540-15"><a href="randomization-statistics.html#cb540-15"></a>  mean_diff &lt;-<span class="st"> </span><span class="kw">mean</span>(<span class="kw">as.matrix</span>(kin_bnf)) <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(<span class="kw">as.matrix</span>(kin_other))</span>
<span id="cb540-16"><a href="randomization-statistics.html#cb540-16"></a>  </span>
<span id="cb540-17"><a href="randomization-statistics.html#cb540-17"></a>  <span class="kw">return</span>(mean_diff)</span>
<span id="cb540-18"><a href="randomization-statistics.html#cb540-18"></a>}</span>
<span id="cb540-19"><a href="randomization-statistics.html#cb540-19"></a></span>
<span id="cb540-20"><a href="randomization-statistics.html#cb540-20"></a><span class="co"># Observed</span></span>
<span id="cb540-21"><a href="randomization-statistics.html#cb540-21"></a>obs &lt;-<span class="st"> </span><span class="kw">kinship_difference</span>(kinship,bnf_status)</span>
<span id="cb540-22"><a href="randomization-statistics.html#cb540-22"></a>obs</span>
<span id="cb540-23"><a href="randomization-statistics.html#cb540-23"></a></span>
<span id="cb540-24"><a href="randomization-statistics.html#cb540-24"></a><span class="co"># Null distribution </span></span>
<span id="cb540-25"><a href="randomization-statistics.html#cb540-25"></a>nulls &lt;-<span class="st"> </span><span class="kw">c</span>()</span>
<span id="cb540-26"><a href="randomization-statistics.html#cb540-26"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">1000</span>){</span>
<span id="cb540-27"><a href="randomization-statistics.html#cb540-27"></a>  bnf_null &lt;-<span class="st"> </span>bnf_status</span>
<span id="cb540-28"><a href="randomization-statistics.html#cb540-28"></a>  bnf_null<span class="op">$</span>bnf &lt;-<span class="st"> </span><span class="kw">sample</span>(bnf_null<span class="op">$</span>bnf,<span class="dt">size=</span><span class="kw">nrow</span>(bnf_null),<span class="dt">replace=</span><span class="ot">FALSE</span>)</span>
<span id="cb540-29"><a href="randomization-statistics.html#cb540-29"></a>  nulli &lt;-<span class="st"> </span><span class="kw">kinship_difference</span>(kinship,bnf_null)</span>
<span id="cb540-30"><a href="randomization-statistics.html#cb540-30"></a>  nulls[i] &lt;-<span class="st"> </span>nulli</span>
<span id="cb540-31"><a href="randomization-statistics.html#cb540-31"></a>}</span>
<span id="cb540-32"><a href="randomization-statistics.html#cb540-32"></a></span>
<span id="cb540-33"><a href="randomization-statistics.html#cb540-33"></a><span class="co"># Visualize</span></span>
<span id="cb540-34"><a href="randomization-statistics.html#cb540-34"></a><span class="kw">par</span>(<span class="dt">mar=</span><span class="kw">c</span>(<span class="fl">4.2</span>,<span class="fl">4.2</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb540-35"><a href="randomization-statistics.html#cb540-35"></a><span class="kw">hist</span>(nulls,<span class="dt">breaks=</span><span class="kw">seq</span>(<span class="op">-</span><span class="dv">6</span>,<span class="dv">6</span>,<span class="dt">by=</span>.<span class="dv">002</span>),<span class="dt">xlim=</span><span class="kw">c</span>(<span class="op">-</span>.<span class="dv">1</span>,.<span class="dv">05</span>),</span>
<span id="cb540-36"><a href="randomization-statistics.html#cb540-36"></a>     <span class="dt">main=</span><span class="ot">NULL</span>,<span class="dt">xlab=</span><span class="st">&quot;Null distribution&quot;</span>,<span class="dt">border=</span><span class="st">&quot;grey70&quot;</span>)</span>
<span id="cb540-37"><a href="randomization-statistics.html#cb540-37"></a><span class="kw">abline</span>(<span class="dt">v=</span>obs,<span class="dt">lwd=</span><span class="dv">2</span>,<span class="dt">lty=</span><span class="dv">3</span>,<span class="dt">col=</span><span class="st">&quot;blue&quot;</span>)</span>
<span id="cb540-38"><a href="randomization-statistics.html#cb540-38"></a></span>
<span id="cb540-39"><a href="randomization-statistics.html#cb540-39"></a><span class="co"># p-value</span></span>
<span id="cb540-40"><a href="randomization-statistics.html#cb540-40"></a>p_value &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">which</span>(nulls <span class="op">&gt;=</span><span class="st"> </span>obs)) <span class="op">/</span><span class="st"> </span><span class="kw">length</span>(nulls)</span>
<span id="cb540-41"><a href="randomization-statistics.html#cb540-41"></a>p_value</span>
<span id="cb540-42"><a href="randomization-statistics.html#cb540-42"></a></span>
<span id="cb540-43"><a href="randomization-statistics.html#cb540-43"></a><span class="co"># Weak evidence for relatedness being a factor in BNF network, but &gt;60% chance! </span></span>
<span id="cb540-44"><a href="randomization-statistics.html#cb540-44"></a><span class="co"># A bit better than coin flip. Interesting!</span></span></code></pre></div>
</div>
</div>
<div id="c-do-social-bonds-relate-to-kinship" class="section level2 unnumbered">
<h2>(c) Do social bonds relate to kinship?</h2>
<p>Finally, let’s ask whether the strength of social bonds is generally correlated to kinship. In other words, is this population assorting according to relatedness?</p>
<p>For your convenience, the social association rate for these 36 individuals has also been summarized in the dataset <a href="https://github.com/databrew/intro-to-data-science/blob/main/data/humpback-sociality.rds?raw=true"><code>humpback-sociality.rds</code></a>.</p>
<div class="sourceCode" id="cb541"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb541-1"><a href="randomization-statistics.html#cb541-1"></a>sociality &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;./data/humpback-sociality.rds&quot;</span>)</span></code></pre></div>
<p><strong>Answer key:</strong></p>
<div class="sourceCode" id="cb542"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb542-1"><a href="randomization-statistics.html#cb542-1"></a><span class="co"># Core function</span></span>
<span id="cb542-2"><a href="randomization-statistics.html#cb542-2"></a>kin_soc &lt;-<span class="st"> </span><span class="cf">function</span>(kinship,sociality){</span>
<span id="cb542-3"><a href="randomization-statistics.html#cb542-3"></a>  ids &lt;-<span class="st"> </span><span class="kw">row.names</span>(kinship) ; ids</span>
<span id="cb542-4"><a href="randomization-statistics.html#cb542-4"></a>  </span>
<span id="cb542-5"><a href="randomization-statistics.html#cb542-5"></a>  mr &lt;-<span class="st"> </span><span class="kw">data.frame</span>()</span>
<span id="cb542-6"><a href="randomization-statistics.html#cb542-6"></a>  i=<span class="dv">1</span> ; j=<span class="dv">10</span></span>
<span id="cb542-7"><a href="randomization-statistics.html#cb542-7"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(ids)){</span>
<span id="cb542-8"><a href="randomization-statistics.html#cb542-8"></a>    idi &lt;-<span class="st"> </span>ids[i] ; idi</span>
<span id="cb542-9"><a href="randomization-statistics.html#cb542-9"></a>    kin_row &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">row.names</span>(kinship)<span class="op">==</span>idi) ; kin_row</span>
<span id="cb542-10"><a href="randomization-statistics.html#cb542-10"></a>    soc_row &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">row.names</span>(sociality)<span class="op">==</span>idi) ; soc_row</span>
<span id="cb542-11"><a href="randomization-statistics.html#cb542-11"></a>        </span>
<span id="cb542-12"><a href="randomization-statistics.html#cb542-12"></a>    <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(ids)){</span>
<span id="cb542-13"><a href="randomization-statistics.html#cb542-13"></a>      idj &lt;-<span class="st"> </span>ids[j]; idj</span>
<span id="cb542-14"><a href="randomization-statistics.html#cb542-14"></a>      </span>
<span id="cb542-15"><a href="randomization-statistics.html#cb542-15"></a>      kin_col &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">colnames</span>(kinship)<span class="op">==</span>idj) ; kin_col</span>
<span id="cb542-16"><a href="randomization-statistics.html#cb542-16"></a>      soc_col &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">colnames</span>(sociality)<span class="op">==</span>idj) ; soc_col</span>
<span id="cb542-17"><a href="randomization-statistics.html#cb542-17"></a>      </span>
<span id="cb542-18"><a href="randomization-statistics.html#cb542-18"></a>      mri &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">A=</span>idi,<span class="dt">B=</span>idj,</span>
<span id="cb542-19"><a href="randomization-statistics.html#cb542-19"></a>                        <span class="dt">kinship=</span>kinship[kin_row,kin_col],</span>
<span id="cb542-20"><a href="randomization-statistics.html#cb542-20"></a>                        <span class="dt">sociality=</span>sociality[soc_row,soc_col])</span>
<span id="cb542-21"><a href="randomization-statistics.html#cb542-21"></a>      mri</span>
<span id="cb542-22"><a href="randomization-statistics.html#cb542-22"></a>      mr &lt;-<span class="st"> </span><span class="kw">rbind</span>(mr,mri)</span>
<span id="cb542-23"><a href="randomization-statistics.html#cb542-23"></a>    }</span>
<span id="cb542-24"><a href="randomization-statistics.html#cb542-24"></a>  }</span>
<span id="cb542-25"><a href="randomization-statistics.html#cb542-25"></a>  mr</span>
<span id="cb542-26"><a href="randomization-statistics.html#cb542-26"></a>  </span>
<span id="cb542-27"><a href="randomization-statistics.html#cb542-27"></a>  <span class="co"># remove navelgazers</span></span>
<span id="cb542-28"><a href="randomization-statistics.html#cb542-28"></a>  navels &lt;-<span class="st"> </span><span class="kw">which</span>(mr<span class="op">$</span>A<span class="op">==</span>mr<span class="op">$</span>B) ; navels</span>
<span id="cb542-29"><a href="randomization-statistics.html#cb542-29"></a>  mr &lt;-<span class="st"> </span>mr[<span class="op">-</span>navels,]</span>
<span id="cb542-30"><a href="randomization-statistics.html#cb542-30"></a>  </span>
<span id="cb542-31"><a href="randomization-statistics.html#cb542-31"></a>  <span class="co">#plot(sociality~kinship,data=mr)</span></span>
<span id="cb542-32"><a href="randomization-statistics.html#cb542-32"></a>  lmi &lt;-<span class="st"> </span><span class="kw">lm</span>(mr<span class="op">$</span>sociality <span class="op">~</span><span class="st"> </span>mr<span class="op">$</span>kinship) </span>
<span id="cb542-33"><a href="randomization-statistics.html#cb542-33"></a>  <span class="co">#abline(lmi)</span></span>
<span id="cb542-34"><a href="randomization-statistics.html#cb542-34"></a>  slopi &lt;-<span class="st"> </span><span class="kw">summary</span>(lmi)<span class="op">$</span>coefficients[<span class="dv">2</span>,<span class="dv">1</span>]</span>
<span id="cb542-35"><a href="randomization-statistics.html#cb542-35"></a>  rsqu &lt;-<span class="st"> </span><span class="kw">summary</span>(lmi)<span class="op">$</span>r.squared</span>
<span id="cb542-36"><a href="randomization-statistics.html#cb542-36"></a>  </span>
<span id="cb542-37"><a href="randomization-statistics.html#cb542-37"></a>  <span class="kw">return</span>(<span class="kw">c</span>(<span class="st">&quot;slope&quot;</span>=slopi,<span class="st">&quot;r&quot;</span>=rsqu))</span>
<span id="cb542-38"><a href="randomization-statistics.html#cb542-38"></a>}</span>
<span id="cb542-39"><a href="randomization-statistics.html#cb542-39"></a></span>
<span id="cb542-40"><a href="randomization-statistics.html#cb542-40"></a><span class="co"># Observed</span></span>
<span id="cb542-41"><a href="randomization-statistics.html#cb542-41"></a>obs &lt;-<span class="st"> </span><span class="kw">kin_soc</span>(kinship,sociality)</span>
<span id="cb542-42"><a href="randomization-statistics.html#cb542-42"></a>obs</span>
<span id="cb542-43"><a href="randomization-statistics.html#cb542-43"></a></span>
<span id="cb542-44"><a href="randomization-statistics.html#cb542-44"></a><span class="co"># Null distribution</span></span>
<span id="cb542-45"><a href="randomization-statistics.html#cb542-45"></a>nulls &lt;-<span class="st"> </span><span class="kw">data.frame</span>()</span>
<span id="cb542-46"><a href="randomization-statistics.html#cb542-46"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">500</span>){</span>
<span id="cb542-47"><a href="randomization-statistics.html#cb542-47"></a>  kin_null &lt;-<span class="st"> </span>kinship</span>
<span id="cb542-48"><a href="randomization-statistics.html#cb542-48"></a>  kin_null &lt;-<span class="st"> </span>kin_null[<span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(kin_null),<span class="dt">size=</span><span class="kw">nrow</span>(kin_null),<span class="dt">replace=</span><span class="ot">FALSE</span>),]</span>
<span id="cb542-49"><a href="randomization-statistics.html#cb542-49"></a>  <span class="kw">row.names</span>(kin_null) &lt;-<span class="st"> </span><span class="kw">row.names</span>(kinship)</span>
<span id="cb542-50"><a href="randomization-statistics.html#cb542-50"></a>  nulli &lt;-<span class="st"> </span><span class="kw">kin_soc</span>(kin_null,sociality)</span>
<span id="cb542-51"><a href="randomization-statistics.html#cb542-51"></a>  nulli &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">slope=</span>nulli[<span class="dv">1</span>],<span class="dt">r=</span>nulli[<span class="dv">2</span>])</span>
<span id="cb542-52"><a href="randomization-statistics.html#cb542-52"></a>  nulls &lt;-<span class="st"> </span><span class="kw">rbind</span>(nulls,nulli)</span>
<span id="cb542-53"><a href="randomization-statistics.html#cb542-53"></a>}</span>
<span id="cb542-54"><a href="randomization-statistics.html#cb542-54"></a></span>
<span id="cb542-55"><a href="randomization-statistics.html#cb542-55"></a><span class="co"># Visualize</span></span>
<span id="cb542-56"><a href="randomization-statistics.html#cb542-56"></a><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb542-57"><a href="randomization-statistics.html#cb542-57"></a><span class="kw">hist</span>(nulls<span class="op">$</span>slope,<span class="dt">breaks=</span><span class="kw">seq</span>(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="dt">by=</span>.<span class="dv">0005</span>),<span class="dt">xlim=</span><span class="kw">c</span>(<span class="op">-</span>.<span class="dv">02</span>,.<span class="dv">02</span>),<span class="dt">main=</span><span class="ot">NULL</span>,<span class="dt">xlab=</span><span class="st">&quot;Null distribution&quot;</span>,<span class="dt">border=</span><span class="st">&quot;grey70&quot;</span>)</span>
<span id="cb542-58"><a href="randomization-statistics.html#cb542-58"></a><span class="kw">text</span>(<span class="op">-</span>.<span class="dv">48</span>,<span class="dv">20</span>,<span class="st">&quot;Slope </span><span class="ch">\n</span><span class="st">estimate&quot;</span>,<span class="dt">pos=</span><span class="dv">4</span>)</span>
<span id="cb542-59"><a href="randomization-statistics.html#cb542-59"></a><span class="kw">abline</span>(<span class="dt">v=</span>obs[<span class="dv">1</span>],<span class="dt">lwd=</span><span class="dv">2</span>,<span class="dt">lty=</span><span class="dv">3</span>,<span class="dt">col=</span><span class="st">&quot;blue&quot;</span>)</span>
<span id="cb542-60"><a href="randomization-statistics.html#cb542-60"></a></span>
<span id="cb542-61"><a href="randomization-statistics.html#cb542-61"></a><span class="kw">hist</span>(nulls<span class="op">$</span>r,<span class="dt">breaks=</span><span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dt">by=</span>.<span class="dv">0001</span>),<span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">0</span>,.<span class="dv">01</span>),<span class="dt">main=</span><span class="ot">NULL</span>,<span class="dt">xlab=</span><span class="st">&quot;Null distribution&quot;</span>,<span class="dt">border=</span><span class="st">&quot;grey70&quot;</span>)</span>
<span id="cb542-62"><a href="randomization-statistics.html#cb542-62"></a><span class="kw">text</span>(.<span class="dv">06</span>,<span class="dv">20</span>,<span class="st">&quot;Correlation </span><span class="ch">\n</span><span class="st">coefficient&quot;</span>,<span class="dt">pos=</span><span class="dv">4</span>)</span>
<span id="cb542-63"><a href="randomization-statistics.html#cb542-63"></a><span class="kw">abline</span>(<span class="dt">v=</span>obs[<span class="dv">2</span>],<span class="dt">lwd=</span><span class="dv">2</span>,<span class="dt">lty=</span><span class="dv">3</span>,<span class="dt">col=</span><span class="st">&quot;blue&quot;</span>)</span>
<span id="cb542-64"><a href="randomization-statistics.html#cb542-64"></a></span>
<span id="cb542-65"><a href="randomization-statistics.html#cb542-65"></a><span class="co"># P-value of slope</span></span>
<span id="cb542-66"><a href="randomization-statistics.html#cb542-66"></a>p_value &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">which</span>(nulls<span class="op">$</span>slope <span class="op">&gt;=</span><span class="st"> </span>obs[<span class="dv">1</span>])) <span class="op">/</span><span class="st"> </span><span class="kw">nrow</span>(nulls)</span>
<span id="cb542-67"><a href="randomization-statistics.html#cb542-67"></a>p_value</span>
<span id="cb542-68"><a href="randomization-statistics.html#cb542-68"></a></span>
<span id="cb542-69"><a href="randomization-statistics.html#cb542-69"></a><span class="co"># P-value of correlation coefficient</span></span>
<span id="cb542-70"><a href="randomization-statistics.html#cb542-70"></a>p_value &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">which</span>(nulls<span class="op">$</span>r <span class="op">&gt;=</span><span class="st"> </span>obs[<span class="dv">2</span>])) <span class="op">/</span><span class="st"> </span><span class="kw">nrow</span>(nulls)</span>
<span id="cb542-71"><a href="randomization-statistics.html#cb542-71"></a>p_value</span>
<span id="cb542-72"><a href="randomization-statistics.html#cb542-72"></a></span>
<span id="cb542-73"><a href="randomization-statistics.html#cb542-73"></a><span class="co"># How to interpret this correlation coefficient? </span></span>
<span id="cb542-74"><a href="randomization-statistics.html#cb542-74"></a><span class="co"># Could it be said that the correlation is unexpectedly POOR? </span></span>
<span id="cb542-75"><a href="randomization-statistics.html#cb542-75"></a><span class="co"># As in, the correlation coefficient is worse than &gt; 95% of outcomes expected under the null distribution? </span></span>
<span id="cb542-76"><a href="randomization-statistics.html#cb542-76"></a><span class="co"># In other words, whales of closer relatedness AVOID each other? At least a hypothesis...</span></span></code></pre></div>
</div>
<div id="other-resources-10" class="section level2 unnumbered">
<h2>Other Resources</h2>
<p><em>NOTE: Under construction!</em></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="apply-family.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="iterative-simulations.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/databrew/intro-to-data-science/edit/master/18-iterative.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["intro-to-data-science.pdf", "intro-to-data-science.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
