# Working with text {#text}

#### Learning goal {-}

* Learn to apply the most common `R` tools for working with text.

&nbsp;  

If you do not learn how to edit and transform text-based fields within datasets, you will quickly get stuck in `R`. Think of dates, GPS coordinates, user IDs, group names, plot labels, *etc.* All of these forms of data can contain non-numeric text. Becoming comfortable working with text in `R` is an essential part of your `R` toolbag.


Here we will present the most common functions for working with text. Remember that `R` has a special object class for text, known to as **character** class, and that character objects are often referred to as **strings**.  

Most of these functions come pre-installed in `R`. However, several of the tools we will show here (as well as many other useful tools that we will not detail here) come from the **`stringr` package**. Go ahead an install `stringr` and load it using `library()`.   


```{r,echo=TRUE,eval=FALSE}
install.packages("stringr")
library(stringr)
```

## Most common tools {-}  

#### `paste()` & `paste0()` {-}

**`paste()`** and **`paste0()`** combines two ore more strings together into a single object:

```{r,echo=TRUE,collapse=TRUE}
i <- 10
n <- 96
file_name <- "this_file.csv"

paste(i,"of",n,": Processing",file_name,". . . ")
```

Notice that `paste()` assumes each object is separated by a blank space. " ". `paste0()` assumes no space between objects. Here's the same input but with `paste0()` instead.  

```{r,echo=TRUE,collapse=TRUE}
paste0(i,"of",n,": Processing",file_name,". . . ") 
```

To replicate the original output with `paste()`, you manually add blank spaces like this:  

```{r,echo=TRUE,collapse=TRUE}
paste0(i," of ",n,": Processing ",file_name," . . . ") 
```

You can also use `paste()` to `collapse` multiple objects into a single string.

```{r,echo=TRUE,collapse=TRUE}
x <- 1:10
paste(x,collapse="-")
```

#### `tolower()` & `toupper()` {-}

**`tolower()`** and **`toupper()`** forces all text in a string to lower case or upper case, respectively:

```{r,echo=TRUE,collapse=TRUE}
x <- "That Tree Is Far Away."
tolower(x)
toupper(x)
```

#### `nchar()` {-}

**`nchar()`** returns the number of characters within a string:

```{r,echo=TRUE,collapse=TRUE}
x <- "That Tree Is Far Away."
nchar(x)
```

#### `substr()` {-}

**`substr()`** trims a string according to a start and end character position:

```{r,echo=TRUE,collapse=TRUE}
dates <- c("2021-03-01",
           "2021-03-02",
           "2021-03-03")
substr(dates,1,4) # years
substr(dates,6,7) # months
substr(dates,9,10) # days
```

#### `grep()` {-}

**`grep()`** returns the elements in a character vector that contain a given pattern:

```{r,echo=TRUE,collapse=TRUE}
years <- 1900:1999

# Which elements correspond to the 1980s?
eighties <- grep("198",years)

years[eighties]
```

#### `gsub()` {-}

**`gsub()`** replaces a given pattern with another in a character vector.

```{r,echo=TRUE,collapse=TRUE}
dates <- c("2021-03-01","2021-03-02","2021-03-03")
gsub("-","/",dates)
```

#### `str_pad()` {-}

**`stringr::str_pad()`**: standardize the lengths of strings by "padding" it (e.g., with zeroes) :

```{r,echo=TRUE,collapse=TRUE}
days <- as.character(1:15)
days
stringr::str_pad(days,width=2,side="left",pad="0")
```

#### `str_split()` {-}

**`stringr::str_split()`**: split a string into several strings at the occurrence of a specified character.

```{r,echo=TRUE,collapse=TRUE}
dates <- c("2021-03-01","2021-03-02","2021-03-03")
splits <- stringr::str_split(dates,"-")
splits
```

This function returns a *list* for every element in the original vector. A common need is to retrieve one item from each of the elements in this list. For example, let's say you are trying to retrieve the months of each element in the `dates` vector. The list structure makes this tricky to retrieve. 

Here's the way to do it by drawing upon the `apply()` family of functions:

```{r,echo=TRUE,collapse=TRUE}
sapply(splits, "[[", 1) # years

sapply(splits, "[[", 2) # Months

sapply(splits, "[[", 3) # days
```

#### `as.character()` {-}

**`as.character()`**: converts a non-character object into a character string. 

```{r,echo=TRUE,collapse=TRUE}
x <- c(1,2,3)
as.character(x)
```

```{r,echo=TRUE,collapse=TRUE}
x <- as.factor(c("group1","group2","group3"))
as.character(x)
```

This can be particularly useful when trying to resolve problems caused by factors. One common issue occurs when `R` mistakes a set of numbers as a set of factors. Using `as.character()` can set things right:

```{r,echo=TRUE,collapse=TRUE}
x <- as.factor(c(18,19,20))
x
```

If you try to convert straight to numeric, it does not work:

```{r,echo=TRUE,collapse=TRUE}
as.numeric(x)
```

So convert to character firstL

```{r,echo=TRUE,collapse=TRUE}
as.numeric(as.character(x))
```

### Exercises {-} 

To practice these tools, we will play with the results of a recent survey. View the raw results [here]('https://docs.google.com/spreadsheets/d/1iVt9FX9J2iv3QFKBM7Gzb9dgva70XrW1lxMV4hpekeo/edit?resourcekey#gid=204634767').   

Read the survey into `R` as follows:  

```{r,echo=TRUE,collapse=TRUE, eval = TRUE, message=FALSE}
library(dplyr)
library(gsheet)
survey <- gsheet2tbl('https://docs.google.com/spreadsheets/d/1iVt9FX9J2iv3QFKBM7Gzb9dgva70XrW1lxMV4hpekeo/edit?resourcekey#gid=204634767')
```

To make this spreadsheet easier to work with, let's rename the columns. Currently, the columns are: 

```{r}
names(survey)
```

Rename them like so:  

```{r}
names(survey) <- c('time', 'sex', 'age','sib', 'dad_mus', 
                   'person_mus', 'joe_mus_is', 'eyesight', 
                   'height', 'shoe_size', 'bday', 'money_or_love', 
                   'rps_skill', 'num_pan', 'cats_dogs', 
                   'first_name', 'last_name')
```

**1.** Create a new column named `full_name` that combines the first and last name of each respondent.  

```{r,echo=FALSE,collapse=TRUE, eval = FALSE}
survey <- survey %>% 
  mutate(full_name = paste0(survey$first_name, '_', survey$last_name ))
```

**2.** Simplify the `sex` column so that `m` (lowercase) stands for males, `f` (lowercase) stands for females, and `p` (lowercase) stands for 'Prefer not to say'.

```{r,echo=FALSE,collapse=TRUE, eval = FALSE}
survey <- survey %>% mutate(sex = tolower(substr(sex,1,1)))
```

**3.** Modify the column `money_or_love` such that the first letter is always capitalized. 

**4.** How many characters is each response in the column `eyesight`?

**5.** How many responses in the column `eyesight` have 30 characters or more?

**6.** Modify the column `money_or_love` such that all responses are twenty characters or less.

**7.** Remove the 's' from the responses in the column `cats_dogs`.  

**8.** In the column `joe_mus_is`, replace 'Deeply captivating' with just 'captivating.'  

**9.** How many respondents have the last name 'Brew'?

**10.** How many respondents were born in May?

**11.** Filter the survey only to respondents born in 2000.  

**12.** Replace "both" in the `money_or_love` variable with "Money & Love".

**13.** Get only the first character `dad_mus` variable. 

**14.** How many total characters are in the column `eyesight`?

**15.** How many characters did Joe Brew write for the `eyesight` question?

**16.** How many people in the data were born on the 4th day of the month?

**17.** Create a new variable called `month_born` that has only the month of from the `bday` variable. 

**18.** Do the same thing for `year`. 

**19.** Filter the data set by those born in 2001 and prefer money over love.


